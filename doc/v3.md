# v3 


V3 真正的 WebServer
目前你的服务器虽然快，但它只是一个 Echo Server（原样返回数据）。要成为真正的 WebServer，我们需要引入 HTTP 协议解析。

从代码实现上看，你已经准确地完成了 V3 版本“协议解析持久化” 的核心重构。这种改动非常关键，它标志着你的服务器从处理“不可靠的数据片段”升级到了处理“完整的应用层协议报文”。

                 ┌────────────┐
accept() ───────▶│ Connection │
                 └─────┬──────┘
                       │
                       ▼
               ┌─────────────────┐
               │ EpollReactor     │
               │  (IO only)       │
               └─────┬───────────┘
                     │ event
        ┌────────────┴────────────┐
        ▼                         ▼
┌──────────────┐        ┌────────────────┐
│ Read Handler │        │ Write Handler  │
│ (parse)      │        │ (flush buffer) │
└──────┬───────┘        └────────┬───────┘
       │                          │
       ▼                          ▼
┌────────────────────────────────────────┐
│            HTTP Layer                  │
│  Request Parse / Response Generate     │
└────────────────────────────────────────┘


## 目标与实现




## 项目处理

引入智能指针全覆盖 在 V3 中你已经开始用 std::shared_ptr<Connection>。请确保在 EpollReactor 和 ThreadPool 之间传递时，始终使用 shared_from_this()。这能防止在多线程高并发下，连接被线程池处理到一半时，却被 Reactor 意外销毁导致的 Segmentation Fault。

2. 完善“优雅停机” (Graceful Shutdown) 现在的服务器可能在 CTRL+C 时直接切断所有连接。

建议实现：当收到信号时，先停止接收新连接（close(listen_fd)），等待线程池里的存量任务处理完并发送完最后的响应后，再销毁资源。这在工业级开发中是必须考虑的。