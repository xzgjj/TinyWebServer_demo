# v5

要实现 V5 的主从 Reactor (Main-Sub Reactor) 架构
mmp零拷贝  静态态资源系统

Main-Sub Reactor: 主从 Reactor 线程池
EventLoop

第二阶段的“mmap 文件映射工具类




##  问题解决




LOG_INFO 如果是阻塞式的，性能会受限于磁盘 IO；如果是异步的，性能会受限于环形队列（RingBuffer）的争用


我在 TinyWebServer 中后期，引入了一个测试驱动的 AI 协作审计系统，
通过失败用例 → 模块归因 → 最小上下文喂给 AI，
避免大模型在复杂代码库中的幻觉问题。

Reactor 模型在 线程亲和性（Thread Affinity） 的处理上存在严重的逻辑违背。
test_main、test_single_connection 以及 test_log 全部出现 45秒运行超时，这表明程序陷入了某种 “活锁” (Livelock) 或 “阻塞等待” (Blocked Waiting) 状态。

AsyncLogger::Flush 等待条件错误:
后端线程 ThreadFunc 中，数据被 swap 到了 buffers_to_write 后，buffers_ 确实空了，但磁盘 IO 可能还在进行中。如果此时前端又快速 Append 导致 current_buffer_ 被推入 buffers_，或者后端线程在特定时机未能触发 notify_all，Flush 就会陷入永久等待。

在 EPOLLET (边缘触发) 模式下，如果缓冲区有 8KB 数据而你只读了 4KB，epoll 将不会再次通知你，直到下次有新数据到达。这会导致请求解析不全

减少 UpdateEvent 调用

致命死锁：EventLoop::Loop 无法退出
在 main.cpp 中，服务器启动后进入了 while(g_running) 的死循环：